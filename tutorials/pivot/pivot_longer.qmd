---
title: "From Wide to Long"
---

A dataset is considered wide when repeated measurements are spread across multiple columns. For example, imagine we have a small subset of BFI data where each person has multiple personality items stored across separate columns:

```{r}
library(dplyr)
library(tidyr)
data("bfi", package = "psych")
bfi_small <- bfi %>% 
  mutate(id = row_number()) %>%
  select(id, A1, A2, A3)
head(bfi_small)
```

This is wide because the items A1, A2, and A3 are all separate variables, even though they represent repeated measures of the same underlying construct.

To convert these columns into a long format, we use `pivot_longer()`:

```{r}
bfi_small_long <- bfi_small %>%
  pivot_longer(
    cols = A1:A3,
    names_to = "item",
    values_to = "response"
  )

head(bfi_small_long)
```





Now each row corresponds to a single item response, the item column tells us which item it was, the response column gives the value.

This long structure is ideal for plotting, modeling, and group-based summaries.


## Pivoting Multiple Columns at Once

In real datasets, multiple variables may need pivoting simultaneously.
For example, suppose we have two versions of a test, with “pre” and “post” scores:

```{r}
library(tidyr)
data <- tibble(
  id = 1:3,
  pre_A = c(3, 4, 2),
  post_A = c(4, 5, 3),
  pre_B = c(2, 3, 2),
  post_B = c(3, 4, 3)
)
head(data)
```


We can take all `pre_*` and `post_*` columns long:

```{r}
library(dplyr)
data_long <- data %>%
  pivot_longer(
    cols = -id,
    names_to = c("time", "item"),
    names_sep = "_",
    values_to = "score"
  )
head(data_long)
```


```{webr-r}
#| autorun: true
#| context: setup
library(tibble)
wide_data <- tibble(
  id = 1:4,
  height_Time1 = c(150, 160, 170, 180),
  height_Time2 = c(152, 162, 172, 182),
  weight_Time1 = c(50, 60, 70, 80),
  weight_Time2 = c(52, 62, 72, 82)
)
library(dplyr)
library(tidyr)
```

::: practice

## Practice

Transform the following wide dataset into long format. The dataset contains measurements of height and weight taken at two different time points (Time1 and Time2).

```{r,echo=FALSE}
library(tibble)
wide_data <- tibble(
  id = 1:4,
  height_Time1 = c(150, 160, 170, 180),
  height_Time2 = c(152, 162, 172, 182),
  weight_Time1 = c(50, 60, 70, 80),
  weight_Time2 = c(52, 62, 72, 82)
)
head(wide_data)
```


:::: {.panel-tabset}
## {{< var tab_title.editor >}}

```{webr-r}

```

## {{< var tab_title.solution >}}

```{r}
long_data <- wide_data %>%
  pivot_longer(
    cols = -id,
    names_to = c("measurement", "time"),
    names_sep = "_",
    values_to = "value"
  )
```
::::

:::



